import{j as e,a as n,F as R}from"./jsx-runtime-9dc53467.js";import{r as T}from"./index-76fb7be0.js";import{v as U,b0 as W,a2 as f,G as g,b1 as J,b2 as Z,b3 as z,a7 as Q}from"./SynapseClient-ceb0e6d4.js";import{g as O,B as D}from"./getEndpoint-ac94413e.js";import{u as k,d as X}from"./SynapseTableCell-a0770d03.js";import{d as Y}from"./ToastMessage-02301a16.js";import{u as ee,a as ae,S as te}from"./SchemaDrivenAnnotationEditor-ac553e0d.js";import"./OrientationBanner-1c6f5b11.js";import{d as ne}from"./useEntity-00649ded.js";import"./SkeletonButton-0a3b2bad.js";import{S as oe}from"./SkeletonTable-d1c3c025.js";import{d as b}from"./dayjs.min-f79c4412.js";import{F as ie}from"./FullWidthAlert-88a09c3d.js";import{f as E}from"./DateFormatter-de1e645f.js";import{g as se,a as le}from"./FileHandleUtils-e8d34168.js";import{a as I}from"./UserBadge-8715cf96.js";import{B as A}from"./Button-6cf38875.js";import{S as re}from"./Skeleton-c327557e.js";import{T as de}from"./Tooltip-3e2f7ab3.js";function ce(a){if(!/\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}.\d{3}Z/.test(a))return!1;const o=new Date(a);return o instanceof Date&&!isNaN(o.getTime())&&o.toISOString()===a}function B(a){return typeof a=="number"||typeof a=="boolean"?a.toString():ce(a)?E(b(a)):a}function S(a){const{entityId:o}=a,[t,y]=T.useState(!1),{isInExperimentalMode:_}=U(),{entityMetadata:s,annotations:r,isLoading:p,refetch:l}=ne(o,!0),{data:m}=ee(o,{enabled:_}),{data:d,refetch:c}=ae(o,{enabled:_&&!!m}),h=_&&!!m,w=!!s&&!!d&&b(s.modifiedOn).diff(b(d.validatedOn))>0,i=T.useCallback(async()=>{y(!0);const u=[l(),c()];await Promise.allSettled(u),y(!1)},[l,c]);return p||t?e(oe,{numRows:3,numCols:2}):n(R,{children:[s&&r&&W(r)?n("div",{className:"placeholder",children:["This"," ",f(g(s.concreteType))," ","has no annotations."]}):null,e("table",{className:"AnnotationsTable",children:n("tbody",{children:[r&&Object.keys(r).map(u=>n("tr",{className:"AnnotationsTable__Row",children:[e("td",{className:"AnnotationsTable__Row__Key",children:u}),e("td",{className:"AnnotationsTable__Row__Value",children:Array.isArray(r[u])?r[u].map(B).join(", "):B(r[u])})]},u)),h?n("tr",{className:"AnnotationsTable__Row",children:[e("td",{className:"AnnotationsTable__Row__Key Schema",children:"Validation Schema"}),e("td",{className:"AnnotationsTable__Row__Value",children:e("a",{href:`${O(D.REPO_ENDPOINT)}/repo/v1/schema/type/registered/${m.jsonSchemaVersionInfo.$id}`,target:"_blank",rel:"noopener noreferrer",children:m.jsonSchemaVersionInfo.schemaName})})]}):null]})}),s&&h&&w&&e(ie,{variant:"warning",description:`This ${f(g(s.concreteType))} has changed since it has been last validated. If this ${f(g(s.concreteType))} is expected to have annotations derived from the Validation Schema, they may not yet be visible.`,primaryButtonConfig:{text:"Reload Annotations",onClick:()=>{i()}},isGlobal:!1})]})}try{S.displayName="AnnotationsTable",S.__docgenInfo={description:"",displayName:"AnnotationsTable",props:{entityId:{defaultValue:null,description:"",name:"entityId",required:!0,type:{name:"string"}},versionNumber:{defaultValue:null,description:"",name:"versionNumber",required:!1,type:{name:"number"}}}}}catch{}const v=({entityId:a,versionNumber:o})=>{var r,p,l,m,d,c;const{data:t}=k(a,o),y=t&&J(t.entity),_=t?se(t):void 0;let s;return _&&(s=le(_)),t?e("table",{className:"MetadataTable",children:n("tbody",{children:[n("tr",{className:"MetadataTable__Row",children:[e("td",{className:"MetadataTable__Row__Key",children:"Name"}),e("td",{className:"MetadataTable__Row__Value",children:(r=t.entity)==null?void 0:r.name})]}),n("tr",{className:"MetadataTable__Row",children:[e("td",{className:"MetadataTable__Row__Key",children:"Type"}),e("td",{className:"MetadataTable__Row__Value",children:f(t.entityType)})]}),n("tr",{className:"MetadataTable__Row",children:[e("td",{className:"MetadataTable__Row__Key",children:"Synapse ID"}),e("td",{className:"MetadataTable__Row__Value",children:(p=t.entity)==null?void 0:p.id})]}),y&&n("tr",{className:"MetadataTable__Row",children:[e("td",{className:"MetadataTable__Row__Key",children:"Version"}),e("td",{className:"MetadataTable__Row__Value",children:Z(t.entity)})]}),s&&n("tr",{className:"MetadataTable__Row",children:[e("td",{className:"MetadataTable__Row__Key",children:"Storage"}),e("td",{className:"MetadataTable__Row__Value",children:s})]}),n("tr",{className:"MetadataTable__Row",children:[e("td",{className:"MetadataTable__Row__Key",children:" Last Modified By"}),n("td",{className:"MetadataTable__Row__Value",children:[e(I,{userId:(l=t.entity)==null?void 0:l.modifiedBy})," at"," ",E(b((m=t.entity)==null?void 0:m.modifiedOn))]})]}),n("tr",{className:"MetadataTable__Row",children:[e("td",{className:"MetadataTable__Row__Key",children:"Created By"}),n("td",{className:"MetadataTable__Row__Value",children:[e(I,{userId:(d=t.entity)==null?void 0:d.createdBy})," at"," ",E(b((c=t.entity)==null?void 0:c.createdOn))]})]})]})}):null};try{v.displayName="MetadataTable",v.__docgenInfo={description:"",displayName:"MetadataTable",props:{entityId:{defaultValue:null,description:"",name:"entityId",required:!0,type:{name:"string"}},versionNumber:{defaultValue:null,description:"",name:"versionNumber",required:!1,type:{name:"number"}}}}}catch{}const me=["METADATA","ANNOTATIONS"];function C(a){const{entityId:o,versionNumber:t,show:y,onClose:_,initialTab:s="METADATA",showTabs:r=!0}=a,p=T.useRef(null),[l,m]=T.useState(s),[d,c]=T.useState(!1),[h,w]=T.useState(!1),{data:i}=k(o,t),u=i&&i.permissions.canEdit,M=i&&z(i.entityType),V=M&&i.entity.isLatestVersion,q=l==="METADATA"&&i&&!window.location.href.includes(o),x=n(A,{variant:"contained",onClick:()=>window.open(`${O(D.PORTAL_ENDPOINT)}#!Synapse:${o}`,"_blank","noopener"),children:["Open"," ",i?f(i==null?void 0:i.entityType):""]}),K=l==="ANNOTATIONS"&&d,j=e(A,{variant:"contained",onClick:()=>{p.current.formElement.current.requestSubmit()},children:"Save Annotations"}),F=l==="ANNOTATIONS"&&d,P=e(A,{variant:"outlined",onClick:()=>{h&&c(!1),w(!h)},children:h?"Are you sure? Unsaved changes will be lost":"Cancel"}),L=u&&l==="ANNOTATIONS"&&!d,$=e(de,{title:M&&!V?"Annotations can only be edited on the latest version":void 0,children:e(A,{variant:"contained",disabled:M&&!V,onClick:()=>{c(!0)},children:"Edit"})}),G=n(R,{children:[r&&!d?e("div",{className:"Tabs",children:me.map(N=>e("div",{className:"Tab",role:"tab",onClick:H=>{H.stopPropagation(),m(N)},"aria-selected":N===l,children:N},N))}):null,e("div",{style:l==="ANNOTATIONS"?{}:{display:"none"},children:d?e(Q,{children:e(te,{entityId:o,formRef:p,onSuccess:()=>{Y("Annotations successfully updated.","success"),c(!1)},onCancel:()=>c(!1)})}):e(S,{entityId:o,versionNumber:t})}),e("div",{style:l==="METADATA"?{}:{display:"none"},children:e(v,{entityId:o,versionNumber:t})})]});return e(X,{className:"EntityMetadata",open:y,onCancel:_,maxWidth:d?"md":"sm",title:i?i.entity.name:e(re,{width:"40%"}),content:G,actions:n(R,{children:[F&&P,K&&j,L&&$,q&&x]})})}try{C.displayName="EntityModal",C.__docgenInfo={description:"",displayName:"EntityModal",props:{show:{defaultValue:null,description:"",name:"show",required:!0,type:{name:"boolean"}},entityId:{defaultValue:null,description:"",name:"entityId",required:!0,type:{name:"string"}},versionNumber:{defaultValue:null,description:"",name:"versionNumber",required:!1,type:{name:"number"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"() => void"}},initialTab:{defaultValue:null,description:"",name:"initialTab",required:!1,type:{name:"enum",value:[{value:'"METADATA"'},{value:'"ANNOTATIONS"'}]}},showTabs:{defaultValue:null,description:"",name:"showTabs",required:!1,type:{name:"boolean"}}}}}catch{}export{C as E};
//# sourceMappingURL=EntityModal-e0e1b21f.js.map
