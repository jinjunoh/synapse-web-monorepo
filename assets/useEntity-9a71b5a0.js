import{r as Q}from"./index-76fb7be0.js";import{u as h}from"./useQueries-bd360569.js";import{b6 as M,h as o,m,n as i,l as f,b7 as S}from"./ApplicationSessionManager-cde90ea0.js";import{u as g}from"./useMutation-356b06b5.js";import{u as P}from"./useInfiniteQuery-1e8d33dc.js";import"./getEndpoint-ac94413e.js";import"./OrientationBanner-7be8199b.js";import"./jsx-runtime-9dc53467.js";import{i as w}from"./isEqualWith-40c9fc10.js";import{a as k}from"./isArray-5e3f9107.js";import{i as q}from"./_Map-92f6da1c.js";import{i as T,o as C,p as I,a as v}from"./pick-1a060884.js";import{g as G}from"./InfiniteQueryUtils-54ae7e6b.js";const K=(e,t)=>{if(!(k(e)||k(t))&&!(!q(e)||!q(t))&&!(!T(e,void 0)&&!T(t,void 0)))return w(C(e,a=>a===void 0),C(t,a=>a===void 0),K)};function A(e,t){return w(e,t,K)}function J(e,t){const a=new Set;for(const s of e)a.add(s.id);for(const s of t)if(s.id!=null&&!a.has(s.id))throw new Error(`Proposed schema contains a new column model with ID ${s.id} that is not in the old schema.`)}async function U(e,t,a,s){J(a,s);const n=new Map;for(const y of a)n.set(y.id,y);let c=[];for(const y of s){const u={...y};if(u.id!=null){const d=n.get(u.id);d!=null&&!A(d,u)&&delete u.id}c.push(u)}const r=(await M(e,c)).list,l=[],F=new Set;for(let y=0;y<s.length;y++){const u=s[y].id??null,d=r[y].id;u!=null&&F.add(u),F.add(d),u!=null&&u!==d?l.push({oldColumnId:u,newColumnId:d}):u==null&&l.push({oldColumnId:null,newColumnId:d})}for(const y of a){const u=y.id;F.has(u)||l.push({oldColumnId:u,newColumnId:null})}return{concreteType:"org.sagebionetworks.repo.model.table.TableUpdateTransactionRequest",entityId:t,changes:[{concreteType:"org.sagebionetworks.repo.model.table.TableSchemaChangeRequest",entityId:t,changes:l,orderedColumnIds:r.map(y=>y.id)}]}}function E(e,t,a){return e.invalidateQueries({queryKey:t.getEntityQueryKey(a)})}function _(e,t,a){const{accessToken:s,keyFactory:n}=o();return m({...a,queryKey:n.getEntityVersionQueryKey(e,t),queryFn:()=>i.getEntity(s,e,t==null?void 0:t.toString())})}function j(e,t){const{accessToken:a,keyFactory:s}=o(),n=Q.useMemo(()=>({queries:e.map(c=>({queryKey:s.getEntityVersionQueryKey(c.id,c.versionNumber),queryFn:()=>i.getEntity(a,c.id,c.versionNumber),options:t}))}),[a,e,s,t]);return h(n)}function H(e){const t=f(),{accessToken:a,keyFactory:s}=o();return g({mutationFn:n=>i.createEntity(n,a),onSuccess:async(n,c,r)=>{await E(t,s,n.id),t.setQueryData(s.getEntityQueryKey(n.id),n),e!=null&&e.onSuccess&&await e.onSuccess(n,c,r)}})}function N(e){const t=f(),{accessToken:a,keyFactory:s}=o();return g({...e,mutationFn:n=>i.updateEntity(n,a),onSuccess:async(n,c,r)=>{await E(t,s,n.id),t.setQueryData(s.getEntityQueryKey(n.id),n),e!=null&&e.onSuccess&&await e.onSuccess(n,c,r)}})}function ee(e){const t=f(),{accessToken:a,keyFactory:s}=o();return g({...e,mutationFn:n=>i.deleteEntity(a,n),onSuccess:async(n,c,r)=>{await E(t,s,c),e!=null&&e.onSuccess&&await e.onSuccess(n,c,r)}})}function te(e,t){const{accessToken:s,keyFactory:n}=o();return P({...t,queryKey:n.getEntityVersionsQueryKey(e),queryFn:async c=>await i.getEntityVersions(e,s,c.pageParam,200),initialPageParam:void 0,getNextPageParam:G})}function R(e){return I(e,S[e.concreteType])}function V(e){return v(e,S[e.concreteType])}function ne(e,t,a,s){const{accessToken:n,keyFactory:c}=o();return m({...s,queryKey:c.getEntityJsonQueryKey(e,t,a),queryFn:()=>i.getEntityJson(e,t,a,n),select:r=>{const l=R(r),F=V(r);return{entity:r,entityMetadata:l,annotations:F}}})}function se(e){const t=f(),{accessToken:a,keyFactory:s}=o();return g({...e,mutationFn:n=>{const c=n.id;return i.updateEntityJson(c,n,a)},onSuccess:async(n,c,r)=>{const l=n.id;await E(t,s,l),t.setQueryData(s.getEntityJsonQueryKey(l,void 0,!1),n),e!=null&&e.onSuccess&&await e.onSuccess(n,c,r)}})}function ae(e,t){const{accessToken:a,keyFactory:s}=o();return m({...t,queryKey:s.getEntityPathQueryKey(e),queryFn:()=>i.getEntityPath(e,a)})}function ce(e,t){const{accessToken:a,keyFactory:s}=o();return m({...t,queryKey:s.getEntityPathQueryKey(e),queryFn:()=>i.getEntityACL(e,a)})}function re(e,t){const{accessToken:a,keyFactory:s}=o();return m({...t,queryKey:s.getEntityAliasQueryKey(e),queryFn:()=>i.getEntityAlias(e,a)})}function ue(e,t,a){const{accessToken:s,keyFactory:n}=o();return m({...a,queryKey:n.getEntityEvaluationsQueryKey(e),queryFn:()=>i.getAllEntityEvaluations(e,t,s)})}function oe(e,t){const{accessToken:a,keyFactory:s}=o();return m({...t,queryKey:s.getEntityPermissionsQueryKey(e),queryFn:()=>i.getEntityPermissions(e,a)})}function ie(e){const t=f(),{accessToken:a,keyFactory:s}=o();return g({...e,mutationFn:n=>i.updateEntityACL(n,a),onSuccess:async(n,c,r)=>{await E(t,s,n.id),t.setQueryData(s.getEntityACLQueryKey(n.id),n),e!=null&&e.onSuccess&&await e.onSuccess(n,c,r)}})}function ye(e){const t=f(),{accessToken:a,keyFactory:s}=o();return g({...e,mutationFn:async n=>{const c=await U(a,n.entityId,n.originalColumnModels,n.newColumnModels);return i.updateTable(c,a)},onSuccess:async(n,c,r)=>{await E(t,s,c.entityId),e!=null&&e.onSuccess&&await e.onSuccess(n,c,r)}})}export{N as a,ye as b,ae as c,ne as d,j as e,ue as f,ie as g,re as h,E as i,ce as j,oe as k,H as l,se as m,ee as n,te as o,_ as u};
