import{j as t,a as c,F as ee}from"./jsx-runtime-9dc53467.js";import{r as a,R as ie}from"./index-76fb7be0.js";import{a as ye,V as ge,W as te,X as fe,Y as he,Z as Ce,_ as _e,$ as Ie,a0 as Se}from"./HelpPopover-eee941e9.js";import{t as we,w as xe,bt as be}from"./ApplicationSessionManager-cde90ea0.js";import"./OrientationBanner-7be8199b.js";import{P as Ee}from"./getEndpoint-ac94413e.js";import{S as ne}from"./RegularExpressions-bc0adf55.js";import{a as Re}from"./useGetEntityHeaders-5be71a72.js";import{I as Fe,A as Ve}from"./IconSvg-2975083b.js";import"./SkeletonButton-007d85cd.js";import{S as De}from"./SkeletonTable-fdb2ca5b.js";import{p as Te}from"./papaparse.min-8c9ba15c.js";import{u as ke}from"./UserSearchBoxV2-4dc3609b.js";import{M as le}from"./TextField-5371a958.js";import{E as He}from"./EntityLink-8f9f60d7.js";import{L as Ne}from"./Link-6ae0d01e.js";import{T as v}from"./Typography-1d068b0b.js";import{C as se}from"./FormControlLabel-718f8cb5.js";import{E as ve}from"./EntityFinderModal-bb7e114c.js";import{V as Me,F as Ae}from"./useEntitySelection-395fdfa5.js";import{c as re}from"./cloneDeep-587c61b8.js";import{p as Pe}from"./pluralize-9f2b9a2f.js";import{u as qe}from"./ThemesPlot-4db96b97.js";import{B as f}from"./Box-8faf86fd.js";import{B as O}from"./Button-33299b2c.js";import{I as oe}from"./IconButton-f820fa46.js";import{I as Be}from"./InputLabel-fd013c0b.js";import{M as Le}from"./Tooltip-fe9d0c3e.js";import{M as Oe}from"./Alert-c3fe2b05.js";import{A as Ue}from"./AlertTitle-aeea0d59.js";import{n as ze}from"./noop-cb277961.js";function U({initialValue:r,onChange:o,options:l,delay:s=250,...p}){const[d,g]=a.useState(r);return ke(()=>{o(d)},[o,d],s),t(ye,{freeSolo:!0,disablePortal:!0,isOptionEqualToValue:(h,u)=>u.length==0||h===u,options:l,value:d,onChange:(h,u)=>{g(u??"")},sx:{marginRight:"10px"},renderInput:h=>t(le,{...h,...p,value:d,onChange:u=>g(u.target.value)})})}try{U.displayName="DebouncedInput",U.__docgenInfo={description:"",displayName:"DebouncedInput",props:{initialValue:{defaultValue:null,description:"",name:"initialValue",required:!0,type:{name:"string"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(value: string) => void"}},options:{defaultValue:null,description:"",name:"options",required:!0,type:{name:"string[]"}},delay:{defaultValue:{value:"250"},description:"",name:"delay",required:!1,type:{name:"number"}}}}}catch{}function z({column:r,table:o}){var d;const l=(d=o.getPreFilteredRowModel().flatRows[0])==null?void 0:d.getValue(r.id),s=r.getFilterValue()??"",p=ie.useMemo(()=>typeof l=="number"?[]:Array.from(r.getFacetedUniqueValues().keys()).sort(),[r.getFacetedUniqueValues()]);return t(U,{type:"text",options:p,initialValue:s,onChange:g=>r.setFilterValue(g),label:`Filter by ${r.columnDef.header} (${r.getFacetedUniqueValues().size})`})}try{z.displayName="Filter",z.__docgenInfo={description:"",displayName:"Filter",props:{column:{defaultValue:null,description:"",name:"column",required:!0,type:{name:"Column<any, unknown>"}},table:{defaultValue:null,description:"",name:"table",required:!0,type:{name:"Table<any>"}}}}}catch{}function j(r){const{cell:o}=r,{row:l}=o,{original:s}=l,{id:p,isDummy:d}=s;return d?t(Ne,{href:`${Ee.PORTAL}#!Synapse:${p}`,children:p}):t(He,{entity:s})}function $(r){const{cell:o}=r;return t(v,{variant:"body1",children:o.getContext().getValue()})}function G(r){const{cell:o}=r;return t(v,{variant:"body1",sx:{textTransform:"capitalize"},children:o.getContext().getValue()})}function W(r){const{table:o}=r;return t(se,{checked:o.getIsAllRowsSelected(),indeterminate:o.getIsSomeRowsSelected(),onClick:o.getToggleAllRowsSelectedHandler()})}function Z(r){const{row:o}=r;return t(se,{checked:o.getIsSelected(),disabled:!o.getCanSelect(),indeterminate:o.getIsSomeSelected(),onClick:o.getToggleSelectedHandler()})}try{j.displayName="EntityHeaderNameCell",j.__docgenInfo={description:"",displayName:"EntityHeaderNameCell",props:{}}}catch{}try{$.displayName="EntityHeaderIDCell",$.__docgenInfo={description:"",displayName:"EntityHeaderIDCell",props:{}}}catch{}try{G.displayName="EntityHeaderTypeCell",G.__docgenInfo={description:"",displayName:"EntityHeaderTypeCell",props:{}}}catch{}try{W.displayName="CheckBoxHeader",W.__docgenInfo={description:"",displayName:"CheckBoxHeader",props:{}}}catch{}try{Z.displayName="CheckBoxCell",Z.__docgenInfo={description:"",displayName:"CheckBoxCell",props:{}}}catch{}const M=r=>c("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[t("mask",{id:"mask0_6722_37828",style:{maskType:"alpha"},maskUnits:"userSpaceOnUse",x:"0",y:"0",width:"24",height:"24",children:t("rect",{width:"24",height:"24",fill:"#D9D9D9"})}),t("g",{mask:"url(#mask0_6722_37828)",children:t("path",{d:"M18 20V17H15V15H18V12H20V15H23V17H20V20H18ZM3 21C2.45 21 1.97917 20.8042 1.5875 20.4125C1.19583 20.0208 1 19.55 1 19V5C1 4.45 1.19583 3.97917 1.5875 3.5875C1.97917 3.19583 2.45 3 3 3H17C17.55 3 18.0208 3.19583 18.4125 3.5875C18.8042 3.97917 19 4.45 19 5V10H17V8H3V19H16V21H3ZM3 6H17V5H3V6Z",fill:"#395979"})})]});try{M.displayName="AddAd",M.__docgenInfo={description:"",displayName:"AddAd",props:{}}}catch{}function je(r,o,l){const[s,p]=a.useState({}),[d,g]=a.useState(re(r)),[h,u]=a.useState(""),[A,F]=a.useState([]);a.useEffect(()=>{g(re(r))},[r]);const x=a.useCallback(y=>{u(y),o&&o(y)},[o]),P=a.useCallback(y=>{p({}),g(y),l&&l(y),F([]),x("")},[l,x]);return{rowSelection:s,setRowSelection:p,refsInState:d,setRefsInState:P,newEntityIDs:h,setNewEntityIDs:x,parseErrors:A,setParseErrors:F}}const $e={selectMultiple:!0,versionSelection:Me.DISALLOWED,initialScope:Ae.ALL_PROJECTS,initialContainer:"root"},Ge=10,ae=r=>{const{references:o,isEditable:l,disabled:s,onUpdate:p=ze,removeSelectedRowsButtonText:d="Remove Selected Rows",onUpdateEntityIDsTextbox:g,objectNameCopy:h="entity",hideTextFieldToPasteValue:u=!1,entityFinderConfiguration:A=$e}=r,[F,x]=a.useState([]),[P,y]=a.useState(!1),{rowSelection:V,setRowSelection:de,refsInState:C,setRefsInState:b,newEntityIDs:m,setNewEntityIDs:D,parseErrors:T,setParseErrors:E}=je(o,g,p),q=a.useCallback(n=>{E([`Invalid Synapse ID(s): ${n.join(",")}`])},[E]),B=a.useCallback(n=>{const e=n.map(i=>({targetId:i.trim()}));b([...C,...e])},[C,b]),ce=a.useCallback(()=>{m?m.includes(",")?Te.parse(m,{complete:n=>{if(n.errors.length>0){const e=n.errors.map(i=>i.message);E(e)}else{const e=n.data[0],i=e.filter(S=>!S.trim().match(ne));i.length>0?q(i):B(e)}}}):m.trim().match(ne)?B([m]):q([m]):(E([]),D(""))},[B,m,q,D,E]),w=qe(Pe(h)),Y=a.useMemo(()=>[{id:"select",header:W,cell:Z}],[]),L=a.useMemo(()=>[{accessorFn:n=>n.name,id:"name",cell:j,header:"Name"},{accessorFn:n=>n.id,id:"id",cell:$,header:"SynID"},{accessorFn:n=>n.isDummy?"-":we(xe(n)),id:"type",header:"Type",cell:G,filterFn:"includesString"}],[]),pe=a.useMemo(()=>l?Y.concat(L):L,[L,l,Y]),J=Object.keys(V).length,{data:R,isSuccess:ue,isLoading:X}=Re(C,{throwOnError:!0}),k=a.useMemo(()=>{const n=R?R==null?void 0:R.results:[],e=new Set;n.map(_=>e.add(_.id));const S=C.filter(_=>!e.has(be(_))).map(_=>({id:_.targetId,name:_.targetId,benefactorId:-1,type:"org.sagebionetworks.repo.model.Project",createdOn:"",modifiedOn:"",createdBy:"",modifiedBy:"",isLatestVersion:!0,isDummy:!0}));return n.concat(S)},[C,R]),I=ge({data:k,columns:pe,state:{rowSelection:V,columnFilters:F},enableRowSelection:l,onRowSelectionChange:de,onColumnFiltersChange:x,getCoreRowModel:fe(),getFilteredRowModel:he(),getSortedRowModel:Ce(),getFacetedRowModel:_e(),getFacetedUniqueValues:Ie(),getFacetedMinMaxValues:Se(),columnResizeMode:"onChange"}),me=a.useCallback(()=>{const e=k.filter((i,S)=>V[S]!==!0).map(i=>({targetId:i.id}));b(e)},[k,V,b]),K=J>0,H=k.length,Q=I.getPrePaginationRowModel().rows.length,N=H>Ge;return a.useEffect(function(){N||I.setColumnFilters([])},[I,N]),X?t(De,{numCols:3,numRows:Math.min(10,C.length)}):ue?c("div",{children:[c(f,{display:"flex",justifyContent:"space-between",p:"12px 10px 10px 5px",children:[N&&c(v,{variant:"body1",sx:{marginBottom:"10px"},children:[H," ",w," ",Q<H?`(${Q} visible)`:"",K&&t("span",{children:` (${J} selected)`})]}),l&&C.length>0&&t(O,{variant:"contained",disabled:!K||s,onClick:me,children:d})]}),t(f,{display:"flex",pb:2,children:I.getHeaderGroups().map(n=>n.headers.map(e=>e.isPlaceholder?null:t(ie.Fragment,{children:e.column.getCanFilter()&&N?t(f,{sx:{flexGrow:1},children:t(z,{column:e.column,table:I})}):null},e.column.id)))}),H>0&&t(f,{sx:n=>({overflow:"auto",maxHeight:"250px",paddingLeft:"2px",th:{height:"38px",backgroundColor:n.palette.grey[200],zIndex:100},"tr:nth-of-type(2n)":{backgroundColor:n.palette.grey[100]}}),children:c("table",{style:{borderCollapse:"collapse",width:"100%"},children:[t("thead",{children:I.getHeaderGroups().map(n=>t("tr",{children:n.headers.map(e=>{let i="5%";switch(e.id){case"name":i="50%";break;case"id":i="22%";break;case"type":i="22%";break}return c("th",{colSpan:e.colSpan,style:{width:i,position:"sticky",top:"0px"},children:[e.isPlaceholder?null:c(f,{display:"flex",alignItems:"center",children:[te(e.column.columnDef.header,e.getContext()),t(f,{mx:"auto"}),e.column.getCanSort()&&t(oe,{onClick:e.column.getToggleSortingHandler(),size:"small",sx:{marginLeft:"auto",marginRight:"16px"},children:t(Fe,{icon:e.column.getIsSorted()==="asc"?"sortUp":"sortDown",wrap:!1,fontSize:"inherit",sx:{color:e.column.getIsSorted()?"primary.main":"grey.700",backgroundColor:"none"}})})]}),e.column.getCanResize()&&t("div",{className:`resizer ${e.column.getIsResizing()?"isResizing":""}`,onMouseDown:e.getResizeHandler(),onTouchStart:e.getResizeHandler()})]},e.id)})},n.id))}),t("tbody",{children:I.getRowModel().rows.map(n=>t("tr",{style:{height:"30px"},children:n.getVisibleCells().map(e=>t("td",{style:{width:e.column.getSize()},children:te(e.column.columnDef.cell,e.getContext())},e.id))},n.id))})]})}),t(ve,{configuration:A,promptCopy:`Select ${w} to add to the Synapse ID list`,show:P,title:`Select ${w}`,confirmButtonCopy:`Add ${w}`,onConfirm:n=>{if(u){const e=[...C,...n];b(e),p(e)}else{const e=n.map(_=>_.targetId),S=(m.trim().length>0?m.concat(","):m).concat(e.join(","));D(S)}y(!1)},onCancel:()=>y(!1)}),l&&c(f,{sx:{marginTop:"10px"},children:[u&&c(O,{variant:"outlined",onClick:()=>{y(!0)},startIcon:t(M,{}),disabled:s,children:["Add ",w]}),!u&&c(ee,{children:[t(Be,{htmlFor:"synIDs",children:"Add Synapse IDs"}),c(f,{sx:{display:"grid",gridTemplateColumns:"auto 50px 150px"},children:[t(le,{id:"synIDs",name:"synIDs",fullWidth:!0,onChange:n=>{D(n.target.value)},value:m,placeholder:"Enter a list of Synapse IDs (i.e. 'syn123, syn456')",disabled:s}),t(f,{sx:{padding:"5px 0px 0px 5px"},children:t(Le,{title:"Add a Synapse ID to the list via the Entity Finder",children:t(oe,{disabled:s,onClick:()=>{y(!0)},children:t(M,{})})})}),c(O,{variant:"outlined",onClick:ce,disabled:X||m.trim().length==0||s,startIcon:t(Ve,{}),children:["Add ",w]})]})]}),T&&T.length>0&&c(Oe,{severity:"error",sx:{my:2},children:[t(Ue,{children:"Parsing errors encountered:"}),t("ul",{children:T.map((n,e)=>t(v,{component:T.length>1?"li":"span",lineHeight:1.5,variant:"smallText1",children:n},e))})]})]})]}):t(ee,{})};try{ae.displayName="EntityHeaderTable",ae.__docgenInfo={description:`Renders a sortable/filterable table for a set of entity references.  If editable, onUpdate will be called back
on any entity added/removed.`,displayName:"EntityHeaderTable",props:{references:{defaultValue:null,description:"",name:"references",required:!0,type:{name:"ReferenceList"}},isEditable:{defaultValue:null,description:"",name:"isEditable",required:!0,type:{name:"boolean"}},disabled:{defaultValue:null,description:"",name:"disabled",required:!1,type:{name:"boolean"}},onUpdate:{defaultValue:null,description:"",name:"onUpdate",required:!1,type:{name:"((updatedRefs: ReferenceList) => void)"}},removeSelectedRowsButtonText:{defaultValue:null,description:"",name:"removeSelectedRowsButtonText",required:!1,type:{name:"string"}},onUpdateEntityIDsTextbox:{defaultValue:null,description:"",name:"onUpdateEntityIDsTextbox",required:!1,type:{name:"((value: string) => void)"}},objectNameCopy:{defaultValue:null,description:"",name:"objectNameCopy",required:!1,type:{name:"string"}},hideTextFieldToPasteValue:{defaultValue:null,description:"",name:"hideTextFieldToPasteValue",required:!1,type:{name:"boolean"}},entityFinderConfiguration:{defaultValue:null,description:"",name:"entityFinderConfiguration",required:!1,type:{name:'Omit<EntityFinderProps, "onSelectedChange">'}}}}}catch{}export{ae as E};
